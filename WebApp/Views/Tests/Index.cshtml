@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@model List<WebApp.ViewModels.TestTaskViewModel>

@section Styles {
    <link rel="stylesheet" href="~/css/tests/index.css" asp-append-version="true" />
}

<div class="container py-4">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @foreach (var task in Model)
        {
            var minutes = task.TimeLimit / 60;
            var seconds = task.TimeLimit % 60;
            var cardClass = task.IsCompleted
                ? "border-success"
                : task.IsLocked
                ? "border-secondary bg-light"
                : "border-primary";

            <div class="col">
                <div class="card h-100 shadow-sm @cardClass">
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title d-flex align-items-center justify-content-between">
                            <span>@task.Title</span>
                            @if (task.IsCompleted)
                            {
                                <span class="badge bg-success">@Localizer["Completed"]</span>
                            }
                            else if (task.IsLocked)
                            {
                                <span class="badge bg-secondary">@Localizer["Locked"]</span>
                            }
                        </h5>

                        <p class="card-text text-muted small text-truncate-2">
                            @task.Description
                        </p>

                        <div class="mt-2 mb-3 small">
                            <div>
                                
                                @if (minutes > 0 && seconds > 0)
                                {
                                    @Localizer["TaskTimeLimitMinSec", minutes, seconds]
                                }
                                else if (minutes > 0)
                                {
                                    @Localizer["TaskTimeLimitMinOnly", minutes]
                                }
                                else
                                {
                                    @Localizer["TaskTimeLimitSecOnly", seconds]
                                }
                            </div>
                            <div>@Localizer["Questions", @task.QuestionCount]</div>
                            <div>@Localizer["MaxGrade", @task.MaxPoints]</div>
                            @if (task.IsCompleted)
                            {
                                <div class="text-success mt-1">
                                    @Localizer["Result", @task.EarnedPoints, @task.MaxPoints]
                                </div>
                            }
                        </div>

                        <div class="mt-auto">
                            @if (task.IsCompleted)
                            {
                                <a asp-action="TaskResult" asp-route-id="@task.Id"
                                   class="btn-task btn-task-result">
                                    @Localizer["ViewResult"]
                                </a>
                            }
                            else if (task.IsLocked)
                            {
                                <button class="btn-task btn-task-locked" disabled>
                                    @Localizer["Unavailable"]
                                </button>
                            }
                            else
                            {
                                <a asp-action="TaskPreview" asp-route-id="@task.Id"
                                   class="btn-task btn-task-start">
                                    @Localizer["ViewTask"]
                                </a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
